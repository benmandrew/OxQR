open Oxqr

let%expect_test "test_version_2_pattern_modules" =
  let qr = Qr.make ~version:2 in
  Qr.place_pattern_modules qr 2;
  Printf.printf "\n%s\n" (Qr.to_unicode_string qr);
  [%expect
    {|
    ██████████████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████████████
    ████████              ██████████████████████              ████████
    ████████  ██████████  ██████████████████████  ██████████  ████████
    ████████  ██      ██  ██████████████████████  ██      ██  ████████
    ████████  ██      ██  ██████████████████████  ██      ██  ████████
    ████████  ██      ██  ██████████████████████  ██      ██  ████████
    ████████  ██████████  ██████████████████████  ██████████  ████████
    ████████              ██  ██  ██  ██  ██  ██              ████████
    ██████████████████████████████████████████████████████████████████
    ████████████████████  ████████████████████████████████████████████
    ██████████████████████████████████████████████████████████████████
    ████████████████████  ████████████████████████████████████████████
    ██████████████████████████████████████████████████████████████████
    ████████████████████  ████████████████████████████████████████████
    ██████████████████████████████████████████████████████████████████
    ████████████████████  ████████████████████████████████████████████
    ██████████████████████████████████████████████████████████████████
    ████████████████████  ██████████████████          ████████████████
    ████████████████████████  ██████████████  ██████  ████████████████
    ████████              ██████████████████  ██  ██  ████████████████
    ████████  ██████████  ██████████████████  ██████  ████████████████
    ████████  ██      ██  ██████████████████          ████████████████
    ████████  ██      ██  ████████████████████████████████████████████
    ████████  ██      ██  ████████████████████████████████████████████
    ████████  ██████████  ████████████████████████████████████████████
    ████████              ████████████████████████████████████████████
    ██████████████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████████████
    |}]

let%expect_test "test_version_1_place_data_full" =
  let config = Config.make ~version:1 ~ecl:Config.ECL.L in
  let qr = Qr.make ~version:config.version in
  Qr.place_pattern_modules qr config.version;
  let data = Bytes.of_seq @@ Seq.init 26 (fun _ -> Char.chr 0b11111111) in
  Qr.place_data qr data config.version;
  Printf.printf "\n%s\n" (Qr.to_unicode_string qr);
  [%expect
    {|
    ██████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████
    ████████              ████        ██              ████████
    ████████  ██████████  ████        ██  ██████████  ████████
    ████████  ██      ██  ████        ██  ██      ██  ████████
    ████████  ██      ██  ████        ██  ██      ██  ████████
    ████████  ██      ██  ████        ██  ██      ██  ████████
    ████████  ██████████  ████        ██  ██████████  ████████
    ████████              ██  ██  ██  ██              ████████
    ██████████████████████████        ████████████████████████
    ████████████████████  ████        ████████████████████████
    ████████            ██                            ████████
    ████████                                          ████████
    ████████            ██                            ████████
    ████████                                          ████████
    ████████████████████████                          ████████
    ████████              ████                        ████████
    ████████  ██████████  ████                        ████████
    ████████  ██      ██  ████                        ████████
    ████████  ██      ██  ████                        ████████
    ████████  ██      ██  ████                        ████████
    ████████  ██████████  ████                        ████████
    ████████              ████                        ████████
    ██████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████
    |}]

let%expect_test "test_version_1_place_data_partial" =
  let config = Config.make ~version:1 ~ecl:Config.ECL.L in
  let qr = Qr.make ~version:config.version in
  Qr.place_pattern_modules qr config.version;
  let data = Bytes.of_seq @@ Seq.init 26 (fun _ -> Char.chr 0b10001010) in
  Qr.place_data qr data config.version;
  Printf.printf "\n%s\n" (Qr.to_unicode_string qr);
  [%expect
    {|
    ██████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████
    ████████              ██████  ██  ██              ████████
    ████████  ██████████  ██████████  ██  ██████████  ████████
    ████████  ██      ██  ██████  ██████  ██      ██  ████████
    ████████  ██      ██  ██████  ██  ██  ██      ██  ████████
    ████████  ██      ██  ██████  ██  ██  ██      ██  ████████
    ████████  ██████████  ██████████  ██  ██████████  ████████
    ████████              ██  ██  ██  ██              ████████
    ████████████████████████████  ████████████████████████████
    ████████████████████  ██████  ██  ████████████████████████
    ██████████  ██  ██  ████  ██  ██  ██  ██  ██  ██  ████████
    ██████████████  ████  ██  ██████  ██████  ██████  ████████
    ██████████  ██████  ████████  ██████  ██████  ████████████
    ██████████  ██  ██    ██  ██  ██  ██  ██  ██  ██  ████████
    ████████████████████████  ██  ██  ██  ██  ██  ██  ████████
    ████████              ██████████  ██████  ██████  ████████
    ████████  ██████████  ██████  ██████  ██████  ████████████
    ████████  ██      ██  ██████  ██  ██  ██  ██  ██  ████████
    ████████  ██      ██  ██████  ██  ██  ██  ██  ██  ████████
    ████████  ██      ██  ██████████  ██████  ██████  ████████
    ████████  ██████████  ██████  ██████  ██████  ████████████
    ████████              ██████  ██  ██  ██  ██  ██  ████████
    ██████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████
    ██████████████████████████████████████████████████████████
    |}]
